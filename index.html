<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Farkle Game</title>
    <style>
        body {
            background-color: #1e1e2f;
            color: #f0f0f0;
            font-family: monospace;
            text-align: center;
        }
        #dice-container {
            margin: 20px auto;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .die {
            width: 50px;
            height: 50px;
            line-height: 50px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            font-size: 24px;
            cursor: pointer;
            user-select: none;
        }
        .selected {
            background-color: #f0f0f0;
            color: #1e1e2f;
            font-weight: bold;
        }
        button {
            background-color: #444;
            color: #f0f0f0;
            border: none;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #666;
        }
        #messages {
            white-space: pre-wrap;
            margin: 20px auto;
            max-width: 700px;
            text-align: left;
            border: 1px solid #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            background-color: #2b2b3c;
        }
    </style>
</head>
<body>
    <h1>Farkle Game</h1>
    <div id="scores">You: 0 | Computer: 0</div>
    <div id="messages"></div>
    <div id="dice-container"></div>
    <button id="roll-btn">Roll Dice</button>
    <button id="bank-btn">Bank Points</button>

    <script>
        const diceContainer = document.getElementById('dice-container');
        const rollBtn = document.getElementById('roll-btn');
        const bankBtn = document.getElementById('bank-btn');
        const messages = document.getElementById('messages');
        const scoresDiv = document.getElementById('scores');

        let humanScore = 0;
        let computerScore = 0;
        let turnScore = 0;
        let diceRemaining = 6;
        let currentRoll = [];
        let selectedDice = [];

        const winningScore = 10000;

        function log(msg) {
            messages.textContent += msg + '\n';
            messages.scrollTop = messages.scrollHeight;
        }

        function rollDice(n) {
            const result = [];
            for (let i=0;i<n;i++) result.push(Math.floor(Math.random()*6)+1);
            return result;
        }

        function countValues(arr) {
            const counts = {};
            for (let d of arr) counts[d] = (counts[d] || 0) + 1;
            return counts;
        }

        function scoreRoll(dice) {
            if(dice.length === 0) return 0;
            const counts = countValues(dice);
            let score = 0;

            // Straight 1-6
            if(Object.keys(counts).length === 6) return 1500;
            // Three pairs
            if(Object.values(counts).filter(v=>v===2).length === 3) return 1500;
            // Two triplets
            if(Object.values(counts).filter(v=>v===3).length === 2) return 2500;
            // Four + two
            if(Object.values(counts).includes(4) && Object.values(counts).includes(2)) return 1500;

            for(let die in counts){
                let qty = counts[die];
                die = parseInt(die);
                if(qty>=3){
                    let base = die===1?1000:die*100;
                    score += base * Math.pow(2, qty-3);
                }
            }

            const onesLeft = (counts[1] || 0) %3;
            const fivesLeft = (counts[5] || 0) %3;
            score += onesLeft*100 + fivesLeft*50;
            return score;
        }

        function updateDiceUI() {
            diceContainer.innerHTML = '';
            currentRoll.forEach((die,i)=>{
                const dieDiv = document.createElement('div');
                dieDiv.textContent = die;
                dieDiv.classList.add('die');
                if(selectedDice.includes(i)) dieDiv.classList.add('selected');
                dieDiv.addEventListener('click', ()=>{
                    if(selectedDice.includes(i)){
                        selectedDice = selectedDice.filter(x=>x!==i);
                    } else {
                        selectedDice.push(i);
                    }
                    updateDiceUI();
                });
                diceContainer.appendChild(dieDiv);
            });
        }

        function startHumanTurn(){
            turnScore = 0;
            diceRemaining = 6;
            log("\nYour turn!");
            rollCurrentDice();
        }

        function rollCurrentDice(){
            if(diceRemaining===0) diceRemaining=6;
            currentRoll = rollDice(diceRemaining);
            selectedDice = [];
            updateDiceUI();
            if(scoreRoll(currentRoll)===0){
                log("Farkle! No points this turn.");
                endHumanTurn(0);
            }
        }

        rollBtn.addEventListener('click', ()=>{
            if(selectedDice.length===0){
                log("Select at least one scoring die first!");
                return;
            }
            const keepDice = selectedDice.map(i=>currentRoll[i]);
            const keptScore = scoreRoll(keepDice);
            if(keptScore===0){
                log("Selected dice do not score! Pick scoring dice.");
                return;
            }
            turnScore += keptScore;
            diceRemaining -= keepDice.length;
            log(`Kept ${keepDice}, scored ${keptScore}. Turn total: ${turnScore}`);
            selectedDice=[];
            currentRoll=currentRoll.filter((_,i)=>!selectedDice.includes(i));
            updateDiceUI();
        });

        bankBtn.addEventListener('click', ()=>{
            endHumanTurn(turnScore);
        });

        function endHumanTurn(score){
            humanScore += score;
            updateScores();
            if(humanScore>=winningScore){
                log("You win!");
                rollBtn.disabled=true;
                bankBtn.disabled=true;
            } else {
                setTimeout(startComputerTurn,1000);
            }
        }

        function updateScores(){
            scoresDiv.textContent = `You: ${humanScore} | Computer: ${computerScore}`;
        }

        function startComputerTurn(){
            log("\nComputer's turn!");
            let compTurnScore = 0;
            let compDice = 6;
            while(true){
                let roll = rollDice(compDice);
                log(`Computer rolled: ${roll}`);
                if(scoreRoll(roll)===0){
                    log("Computer Farkled! No points this turn.");
                    break;
                }
                const counts = countValues(roll);
                const keepDice = [];
                for(let die in counts){
                    let d=parseInt(die), q=counts[die];
                    if(q>=3 || d===1 || d===5){
                        for(let k=0;k<q;k++) keepDice.push(d);
                    }
                }
                let keptScore = scoreRoll(keepDice);
                compTurnScore += keptScore;
                compDice -= keepDice.length;
                log(`Computer keeps ${keepDice}, scores ${keptScore}, turn total ${compTurnScore}`);
                if(compDice<=2 || compTurnScore>=500) break;
                if(compDice===0) compDice=6;
            }
            computerScore += compTurnScore;
            updateScores();
            if(computerScore>=winningScore){
                log("Computer wins!");
                rollBtn.disabled=true;
                bankBtn.disabled=true;
            } else {
                startHumanTurn();
            }
        }

        // Start game
        startHumanTurn();
    </script>
</body>
</html>



